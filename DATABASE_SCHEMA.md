# Database Schema – Task Management System

## Overview

This project uses **MongoDB** with **Mongoose** for object modeling. The database has two main collections:
- `users`
- `tasks`

Each task is owned by a user through a reference from `tasks.userId` → `users._id`.

---

## Users Collection

**Model file:** `server/models/User.js`

**Collection name (Mongoose):** `users`

### Fields

| Field      | Type      | Required | Unique | Default | Description                          |
|-----------|-----------|---------:|:------:|---------|--------------------------------------|
| `_id`     | ObjectId  | Yes      | Yes    | Auto    | Primary key generated by MongoDB     |
| `name`    | String    | Yes      | No     | –       | Full name of the user                |
| `email`   | String    | Yes      | Yes    | –       | User email, stored lowercase         |
| `password`| String    | Yes      | No     | –       | Hashed password (bcrypt)             |
| `createdAt` | Date    | Yes      | No     | Auto    | Timestamp when the user was created  |
| `updatedAt` | Date    | Yes      | No     | Auto    | Timestamp when the user was updated  |

### Constraints & Behavior

- `email` is **unique** and **lowercased**.
- `password` is never stored in plain text:
  - Before saving, a Mongoose **pre-save hook** hashes the password using bcrypt.
- Timestamps are enabled via `{ timestamps: true }`.

### Example Document

```json
{
  "_id": "661f1c8e2a9d3b0012345678",
  "name": "John Doe",
  "email": "john@example.com",
  "password": "$2a$10$hashedPasswordHere",
  "createdAt": "2024-04-17T10:15:30.000Z",
  "updatedAt": "2024-04-17T10:15:30.000Z"
}
```

---

## Tasks Collection

**Model file:** `server/models/Task.js`

**Collection name (Mongoose):** `tasks`

### Fields

| Field       | Type      | Required | Default     | Allowed Values                       | Description                                   |
|------------|-----------|---------:|------------|--------------------------------------|-----------------------------------------------|
| `_id`      | ObjectId  | Yes      | Auto       | –                                    | Primary key                                   |
| `title`    | String    | Yes      | –          | –                                    | Short title of the task                       |
| `description` | String | No       | `""`       | –                                    | Detailed description                          |
| `category` | String    | No       | `"General"`| –                                    | Category label (e.g., Work, Personal)         |
| `priority` | String    | No       | `"Medium"` | `Low`, `Medium`, `High`              | Importance level                              |
| `status`   | String    | No       | `"Pending"`| `Pending`, `In Progress`, `Completed`| Current state of the task                     |
| `dueDate`  | Date      | No       | `null`     | –                                    | Optional due date                             |
| `userId`   | ObjectId  | Yes      | –          | – (ref: `User`)                      | Reference to the owning user                  |
| `createdAt`| Date      | Yes      | Auto       | –                                    | Timestamp when the task was created           |
| `updatedAt`| Date      | Yes      | Auto       | –                                    | Timestamp when the task was last updated      |

### Constraints & Behavior

- `title` is required.
- `priority` is restricted to one of `Low`, `Medium`, `High` via `enum`.
- `status` is restricted to one of `Pending`, `In Progress`, `Completed` via `enum`.
- `userId` is required and must be a valid `ObjectId` referencing the `users` collection.
- Timestamps are enabled via `{ timestamps: true }`.

### Example Document

```json
{
  "_id": "661f1dc72a9d3b0012345679",
  "title": "Complete project documentation",
  "description": "Write and review all API docs before release.",
  "category": "Work",
  "priority": "High",
  "status": "In Progress",
  "dueDate": "2024-12-31T23:59:59.000Z",
  "userId": "661f1c8e2a9d3b0012345678",
  "createdAt": "2024-04-17T10:20:00.000Z",
  "updatedAt": "2024-04-17T10:25:00.000Z"
}
```

---

## Relationships

- **User → Tasks (One-to-Many)**
  - One user can have many tasks.
  - Implemented via `tasks.userId` referencing `users._id`.
  - All task queries in the API filter by `userId` to ensure users only see their own tasks.

Example query pattern (`server/controllers/taskController.js`):

```js
const tasks = await Task.find({ userId: req.userId }).sort({ createdAt: -1 });
```

---

## Indexes

- Default indexes:
  - `_id` is automatically indexed by MongoDB for `users` and `tasks`.
- Additional logical indexes:
  - `users.email` is defined as `unique: true` at the schema level to prevent duplicate accounts.

If needed for scale, you can add additional indexes, such as:

- `{ userId: 1, status: 1 }` on `tasks` for faster dashboard queries.

---

## Environment Configuration

The MongoDB connection string is configured via:

- **File:** `server/.env`
- **Variable:** `MONGODB_URI`

Example:

```env
MONGODB_URI=mongodb+srv://<user>:<password>@cluster0.xxxxx.mongodb.net/taskmanagement?retryWrites=true&w=majority
```

The connection is established in `server/config/db.js` using Mongoose.

